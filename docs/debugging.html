<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Profiling and Debugging</title>

<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="site_libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="site_libs/d3-3.5.6/d3.min.js"></script>
<link href="site_libs/profvis-0.3.6.9000/profvis.css" rel="stylesheet" />
<script src="site_libs/profvis-0.3.6.9000/profvis.js"></script>
<script src="site_libs/profvis-0.3.6.9000/scroll.js"></script>
<link href="site_libs/highlight-6.2.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlight-6.2.0/highlight.js"></script>
<script src="site_libs/profvis-binding-0.3.7/profvis.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Portfolio 2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="debugging.html">Profiling and Debugging</a>
</li>
<li>
  <a href="matrices.html">Matrices</a>
</li>
<li>
  <a href="optimisation.html">Optimisation</a>
</li>
<li>
  <a href="Integration.html">Integration</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Profiling and Debugging</h1>

</div>


<div id="debugging" class="section level2">
<h2>Debugging</h2>
<p>Bugs are an inherent part of programming, it is important to know how to deal with them.</p>
<div id="approach" class="section level3">
<h3>Approach</h3>
<ul>
<li><p>Understand the error that is occuring, this may require searching the given error message to work out what has gone wrong.</p></li>
<li><p>Create a reproducible, minimal working example of the unintended behaviour.</p></li>
<li><p>Identify where the code is going wrong. Using print statements at various points in your code can help with this.</p></li>
<li><p>Fix the bug and add tests to ensure the bug is not reintroduced at a later date.</p></li>
</ul>
<p>A minimum working example is what you would need to submit with a bug report if there was a problem in someone elses code. If a lot of bugs are emerging in code it can help to tackle the problem in smaller parts.</p>
</div>
<div id="example" class="section level3">
<h3>Example</h3>
<p>We attempt to build a function that finds prime factors. We have the following:</p>
<pre class="r"><code>prime_factors2 &lt;- function(n){
  factors &lt;- c()
  i &lt;- 2
  r &lt;- n
  while(prod(factors) != n){
    if(r%%i == 0) {
      factors &lt;- c(factors,i)
      r &lt;- r/i
      }
    i &lt;- i+1
  }
  return(factors)
}</code></pre>
<p>But when we run it on a simple example <code>prime_factors2(12)</code> it gets stuck in a never ending loop. To test why this happens we add some print statements within the function to examine it’s behaviour. We also add a break when <code>i</code> exceeds the number it is factorising.</p>
<pre class="r"><code>prime_factors2 &lt;- function(n){
  factors &lt;- c()
  i &lt;- 2
  r &lt;- n
  while(prod(factors) != n){
    if(r%%i == 0) {
      factors &lt;- c(factors,i)
      r &lt;- r/i
      print(paste(&quot;factors =&quot;, factors))
      print(paste(&quot;remainder =&quot;, r))
      }
    i &lt;- i+1
    print(paste(&quot;divisor =&quot;, i))
    if (i &gt; r) {
      break
    }
  }
  return(factors)
}</code></pre>
<p>We run this again on some simple examples.</p>
<pre class="r"><code>prime_factors2(21)</code></pre>
<pre><code>## [1] &quot;divisor = 3&quot;
## [1] &quot;factors = 3&quot;
## [1] &quot;remainder = 7&quot;
## [1] &quot;divisor = 4&quot;
## [1] &quot;divisor = 5&quot;
## [1] &quot;divisor = 6&quot;
## [1] &quot;divisor = 7&quot;
## [1] &quot;factors = 3&quot; &quot;factors = 7&quot;
## [1] &quot;remainder = 1&quot;
## [1] &quot;divisor = 8&quot;</code></pre>
<pre><code>## [1] 3 7</code></pre>
<pre class="r"><code>prime_factors2(12)</code></pre>
<pre><code>## [1] &quot;factors = 2&quot;
## [1] &quot;remainder = 6&quot;
## [1] &quot;divisor = 3&quot;
## [1] &quot;factors = 2&quot; &quot;factors = 3&quot;
## [1] &quot;remainder = 2&quot;
## [1] &quot;divisor = 4&quot;</code></pre>
<pre><code>## [1] 2 3</code></pre>
<p>So we get the correct result for 21, but not for 12. It looks like the function doesn’t detect repeating primes in the factorisation, we test the hypothesis on another simple example.</p>
<pre class="r"><code>prime_factors2(8)</code></pre>
<pre><code>## [1] &quot;factors = 2&quot;
## [1] &quot;remainder = 4&quot;
## [1] &quot;divisor = 3&quot;
## [1] &quot;divisor = 4&quot;
## [1] &quot;factors = 2&quot; &quot;factors = 4&quot;
## [1] &quot;remainder = 1&quot;
## [1] &quot;divisor = 5&quot;</code></pre>
<pre><code>## [1] 2 4</code></pre>
<p>So again it didn’t find the correct divisors and in fact returned 4 as a prime factor. The divisor is exceeding the remainder before it has finished dividing. To fix this we try resetting the divisor after every successful factorisation as this will allow it to find repeated prime factors.</p>
<pre class="r"><code>prime_factors2 &lt;- function(n){
  factors &lt;- c()
  i &lt;- 2
  r &lt;- n
  while(prod(factors) != n){
    if(r%%i == 0) {
      factors &lt;- c(factors,i)
      r &lt;- r/i
      i &lt;- 1
      }
    i &lt;- i+1
  }
  return(factors)
}</code></pre>
<p>and retry on the earlier failed examples:</p>
<pre class="r"><code>prime_factors2(8)</code></pre>
<pre><code>## [1] 2 2 2</code></pre>
<pre class="r"><code>prime_factors2(12)</code></pre>
<pre><code>## [1] 2 2 3</code></pre>
<p>It now works correctly!</p>
</div>
</div>
<div id="profiling" class="section level2">
<h2>Profiling</h2>
<p>Profiling in R can be done through the <code>profvis</code> package which builds upon R’s <code>Rprof</code> functionality.</p>
<pre class="r"><code>library(profvis)</code></pre>
<p>This is a statistical profiler. It operates by using operating system interrupts to determine what code is being executed. This allows a picture to built of where the computation is spending most of its time.</p>
<p>Statistical profilers are similiar to instrumenting profilers which increment counters whenever functions are called however these often require more overhead than the statistical profilers at the benefit of more accuracy.</p>
<p>These tools are useful for understanding performance and checking the robustness of code.</p>
<div id="example-1" class="section level3">
<h3>Example</h3>
<p>We compare the new prime factors function <code>prime_factors2</code> to the one that we created in the first portfolio.</p>
<pre class="r"><code>source(&quot;prime_factors1.R&quot;, keep.source = TRUE)
profvis(prime_factors(12416515098))</code></pre>
<div id="htmlwidget-44352e1032b852a97aa6" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-44352e1032b852a97aa6">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,5,6,6,6,6,6,6,6,7,7,8,8,8,8,8,8,8,9,9,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,14,14,14,14,14,14,14,15,15,15,15,15,15,15,16,16,16,16,16,16,16,17,17,17,17,17,17,17,18,18,19,19,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22],"depth":[25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,2,1,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,7,6,5,4,3,2,1,2,1,2,1,7,6,5,4,3,2,1,8,7,6,5,4,3,2,1,7,6,5,4,3,2,1],"label":["cmpCallArgs","cmpCallSymFun","cmpCall","cmp","cmpSymbolAssign","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","rmarkdown::render_site","%%","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","i = i + 1 }\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","%%","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","%%","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","<GC>","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","%%","rmarkdown::render_site","%%","rmarkdown::render_site","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","<GC>","while ((x %% i) != 0) {\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site","i = i + 1 }\r","prime_factors","prime_factors","prime_factors","prime_factors","prime_factors","rmarkdown::render_site"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,null,1,1,1,1,1,null,null,1,null,1,1,1,1,1,null,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null,1,null,1,null,1,1,1,1,1,null,null,null,1,1,1,1,1,null,null,1,1,1,1,1,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,5,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,6,11,11,11,11,null,null,5,null,5,11,11,11,11,null,null,5,null,5,11,11,11,11,null,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,11,11,11,11,null,null,5,null,5,null,5,11,11,11,11,null,null,null,5,11,11,11,11,null,null,6,11,11,11,11,null,null],"memalloc":[54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.4611892700195,54.9208984375,54.9208984375,55.3949203491211,55.3949203491211,55.3949203491211,55.3949203491211,55.3949203491211,55.3949203491211,55.3949203491211,55.8725357055664,55.8725357055664,55.8725357055664,55.8725357055664,55.8725357055664,55.8725357055664,55.8725357055664,56.3443374633789,56.3443374633789,56.3443374633789,56.3443374633789,56.3443374633789,56.3443374633789,56.3443374633789,56.8073348999023,56.8073348999023,56.8073348999023,56.8073348999023,56.8073348999023,56.8073348999023,56.8073348999023,57.2769622802734,57.2769622802734,57.7449417114258,57.7449417114258,57.7449417114258,57.7449417114258,57.7449417114258,57.7449417114258,57.7449417114258,58.2162017822266,58.2162017822266,58.6600036621094,58.6600036621094,58.6600036621094,58.6600036621094,58.6600036621094,58.6600036621094,58.6600036621094,58.7954483032227,58.7954483032227,58.7954483032227,58.7954483032227,58.7954483032227,58.7954483032227,58.7954483032227,58.7954483032227,54.8057174682617,54.8057174682617,54.8057174682617,54.8057174682617,54.8057174682617,54.8057174682617,54.8057174682617,55.2909774780273,55.2909774780273,55.2909774780273,55.2909774780273,55.2909774780273,55.2909774780273,55.2909774780273,55.7680587768555,55.7680587768555,55.7680587768555,55.7680587768555,55.7680587768555,55.7680587768555,55.7680587768555,56.2443389892578,56.2443389892578,56.2443389892578,56.2443389892578,56.2443389892578,56.2443389892578,56.2443389892578,56.7228088378906,56.7228088378906,56.7228088378906,56.7228088378906,56.7228088378906,56.7228088378906,56.7228088378906,57.2117614746094,57.2117614746094,57.2117614746094,57.2117614746094,57.2117614746094,57.2117614746094,57.2117614746094,57.6956024169922,57.6956024169922,58.1741104125977,58.1741104125977,58.6529006958008,58.6529006958008,58.6529006958008,58.6529006958008,58.6529006958008,58.6529006958008,58.6529006958008,58.8371887207031,58.8371887207031,58.8371887207031,58.8371887207031,58.8371887207031,58.8371887207031,58.8371887207031,58.8371887207031,54.7506408691406,54.7506408691406,54.7506408691406,54.7506408691406,54.7506408691406,54.7506408691406,54.7506408691406],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.459709167480469,0,0.474021911621094,0,0,0,0,0,0,0.477615356445312,0,0,0,0,0,0,0.4718017578125,0,0,0,0,0,0,0.462997436523438,0,0,0,0,0,0,0.469627380371094,0,0.467979431152344,0,0,0,0,0,0,0.471260070800781,0,0.443801879882812,0,0,0,0,0,0,0.135444641113281,0,0,0,0,0,0,0,-3.98973083496094,0,0,0,0,0,0,0.485260009765625,0,0,0,0,0,0,0.477081298828125,0,0,0,0,0,0,0.476280212402344,0,0,0,0,0,0,0.478469848632812,0,0,0,0,0,0,0.48895263671875,0,0,0,0,0,0,0.483840942382812,0,0.478507995605469,0,0.478790283203125,0,0,0,0,0,0,0.184288024902344,0,0,0,0,0,0,0,-4.0865478515625,0,0,0,0,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"prime_factors1.R",null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R",null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R",null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R",null,"prime_factors1.R",null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null,"prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R","prime_factors1.R",null,null]},"interval":10,"files":[{"filename":"prime_factors1.R","content":"prime_factors <- function(x) {\r\n  factors = c()\r\n  i = 2\r\n  # Find the smallest factor of x\r\n  while ((x %% i) != 0) {\r\n    i = i + 1 }\r\n  # Check if factor is a prime\r\n  if (i == x) {\r\n    return(x) }\r\n  else {\r\n    factors = append(factors, c(prime_factors(i), prime_factors(x/i)))\r\n    return(factors)\r\n  }\r\n}","normpath":"C:/Users/euane/Documents/R Projects/markdown/prime_factors1.R"}],"prof_output":"C:/Users/euane/Documents/R Projects/markdown/.Rproj.user/C012E727/profiles-cache\\file2074242e1917.Rprof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>source(&quot;prime_factors2.R&quot;, keep.source = TRUE)
profvis(prime_factors2(12416515098))</code></pre>
<div id="htmlwidget-56b52ede6b6fa7ed43e5" style="width:100%;height:600px;" class="profvis html-widget"></div>
<script type="application/json" data-for="htmlwidget-56b52ede6b6fa7ed43e5">{"x":{"message":{"prof":{"time":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,4,4,5,5,6,6,6,7,7,8,8,8,9,9,10,10,11,11,12,12,12,13,13,13,14,14,14,15,15,16,16,17,17,18,18,18,18,19,19,19,20,20,21,21,22,22,22,23,23,23,24,24,25,25,26,26,26,27,27,28,28,29,29,29,30,30,31,31,31,32,32,33,33,33,34,34,34,35,35,35,36,36,36,37,37,38,38,38,39,39,39,40,40,41,41,41,42,42,42,43,43,44,44,45,45,45,46,46,46,47,47,48,48,48,49,49,49,50,50,50,51,51,51,52,52,53,53,53,53,54,54,54],"depth":[22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,2,1,2,1,2,1,2,1,3,2,1,2,1,3,2,1,2,1,2,1,2,1,3,2,1,3,2,1,3,2,1,2,1,2,1,2,1,4,3,2,1,3,2,1,2,1,2,1,3,2,1,3,2,1,2,1,2,1,3,2,1,2,1,2,1,3,2,1,2,1,3,2,1,2,1,3,2,1,3,2,1,3,2,1,3,2,1,2,1,3,2,1,3,2,1,2,1,3,2,1,3,2,1,2,1,2,1,3,2,1,3,2,1,2,1,3,2,1,3,2,1,3,2,1,3,2,1,2,1,4,3,2,1,3,2,1],"label":["cb$putcode","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","cmpWhileBody","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","rmarkdown::render_site","prod","rmarkdown::render_site","prod","rmarkdown::render_site","prod","rmarkdown::render_site","%%","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","%%","rmarkdown::render_site","%%","rmarkdown::render_site","prod","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","prod","rmarkdown::render_site","%%","rmarkdown::render_site","<GC>","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","i <- i+1\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","%%","rmarkdown::render_site","i <- i+1\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","%%","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","%%","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","%%","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","%%","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","<GC>","prod","rmarkdown::render_site","prod","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","%%","rmarkdown::render_site","prod","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","%%","rmarkdown::render_site","prod","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","while(prod(factors) != n){\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","prod","rmarkdown::render_site","<GC>","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site","if(r%%i == 0) {\r","prime_factors2","rmarkdown::render_site"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,1,null,1,null,1,null,1,null,null,1,null,1,null,null,1,null,1,null,1,null,1,null,null,1,null,null,1,null,null,1,null,1,null,1,null,null,1,null,null,1,null,null,1,null,1,null,1,null,null,1,null,null,1,null,1,null,1,null,null,1,null,1,null,1,null,null,1,null,1,null,null,1,null,1,null,null,1,null,null,1,null,null,null,1,null,1,null,1,null,null,1,1,null,1,null,1,null,null,1,null,null,1,null,1,null,1,null,null,1,null,null,1,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null,1,null,null],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,5,null,5,null,5,null,6,null,5,null,null,5,null,6,null,null,6,null,6,null,5,null,6,null,null,5,null,null,5,null,null,5,null,5,null,6,null,null,5,null,null,10,null,null,5,null,6,null,10,null,null,6,null,null,5,null,6,null,6,null,null,5,null,6,null,5,null,null,6,null,6,null,null,6,null,6,null,null,6,null,null,5,null,null,null,5,null,5,null,6,null,null,6,6,null,5,null,5,null,null,6,null,null,6,null,5,null,6,null,null,6,null,null,5,null,5,null,null,6,null,null,6,null,null,6,null,null,5,null,null,6,null,null,6,null,null],"memalloc":[54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.4379501342773,54.9910507202148,54.9910507202148,55.6519012451172,55.6519012451172,56.0248870849609,56.0248870849609,56.6003189086914,56.6003189086914,57.1102981567383,57.1102981567383,57.1102981567383,57.7080841064453,57.7080841064453,58.1015319824219,58.1015319824219,58.1015319824219,58.6426315307617,58.6426315307617,54.3363952636719,54.3363952636719,54.9393615722656,54.9393615722656,55.537727355957,55.537727355957,55.537727355957,56.1434707641602,56.1434707641602,56.1434707641602,56.7471694946289,56.7471694946289,56.7471694946289,57.3507919311523,57.3507919311523,57.9497528076172,57.9497528076172,58.5297622680664,58.5297622680664,58.8349761962891,58.8349761962891,58.8349761962891,58.8349761962891,54.6171188354492,54.6171188354492,54.6171188354492,55.2026214599609,55.2026214599609,55.7916488647461,55.7916488647461,56.3900833129883,56.3900833129883,56.3900833129883,56.9818878173828,56.9818878173828,56.9818878173828,57.5723724365234,57.5723724365234,58.1592254638672,58.1592254638672,58.7346496582031,58.7346496582031,58.7346496582031,54.388916015625,54.388916015625,54.9910125732422,54.9910125732422,55.3990859985352,55.3990859985352,55.3990859985352,55.9714279174805,55.9714279174805,56.4958343505859,56.4958343505859,56.4958343505859,56.8901138305664,56.8901138305664,57.480354309082,57.480354309082,57.480354309082,58.0730819702148,58.0730819702148,58.0730819702148,58.4575729370117,58.4575729370117,58.4575729370117,58.8349685668945,58.8349685668945,58.8349685668945,54.6968231201172,54.6968231201172,55.3169860839844,55.3169860839844,55.3169860839844,55.9327850341797,55.9327850341797,55.9327850341797,56.5423431396484,56.5423431396484,57.1586532592773,57.1586532592773,57.1586532592773,57.5901336669922,57.5901336669922,57.5901336669922,58.1879577636719,58.1879577636719,58.7804183959961,58.7804183959961,54.4185791015625,54.4185791015625,54.4185791015625,55.0479049682617,55.0479049682617,55.0479049682617,55.6713485717773,55.6713485717773,56.2943878173828,56.2943878173828,56.2943878173828,56.7992935180664,56.7992935180664,56.7992935180664,57.4041213989258,57.4041213989258,57.4041213989258,58.0532455444336,58.0532455444336,58.0532455444336,58.6335144042969,58.6335144042969,58.8349761962891,58.8349761962891,58.8349761962891,58.8349761962891,54.8984451293945,54.8984451293945,54.8984451293945],"meminc":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5531005859375,0,0.660850524902344,0,0.37298583984375,0,0.575431823730469,0,0.509979248046875,0,0,0.597785949707031,0,0.393447875976562,0,0,0.541099548339844,0,-4.30623626708984,0,0.60296630859375,0,0.598365783691406,0,0,0.605743408203125,0,0,0.60369873046875,0,0,0.603622436523438,0,0.598960876464844,0,0.580009460449219,0,0.305213928222656,0,0,0,-4.21785736083984,0,0,0.585502624511719,0,0.589027404785156,0,0.598434448242188,0,0,0.591804504394531,0,0,0.590484619140625,0,0.58685302734375,0,0.575424194335938,0,0,-4.34573364257812,0,0.602096557617188,0,0.408073425292969,0,0,0.572341918945312,0,0.524406433105469,0,0,0.394279479980469,0,0.590240478515625,0,0,0.592727661132812,0,0,0.384490966796875,0,0,0.377395629882812,0,0,-4.13814544677734,0,0.620162963867188,0,0,0.615798950195312,0,0,0.60955810546875,0,0.616310119628906,0,0,0.431480407714844,0,0,0.597824096679688,0,0.592460632324219,0,-4.36183929443359,0,0,0.629325866699219,0,0,0.623443603515625,0,0.623039245605469,0,0,0.504905700683594,0,0,0.604827880859375,0,0,0.649124145507812,0,0,0.580268859863281,0,0.201461791992188,0,0,0,-3.93653106689453,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R","prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null,"prime_factors2.R",null,null]},"interval":10,"files":[{"filename":"prime_factors2.R","content":"prime_factors2 <- function(n){\r\n  factors <- c()\r\n  i <- 2\r\n  r <- n\r\n  while(prod(factors) != n){\r\n    if(r%%i == 0) {\r\n      factors <- c(factors,i)\r\n      r <- r/i\r\n    }\r\n    i <- i+1\r\n  }\r\n  return(factors)\r\n}","normpath":"C:/Users/euane/Documents/R Projects/markdown/prime_factors2.R"}],"prof_output":"C:/Users/euane/Documents/R Projects/markdown/.Rproj.user/C012E727/profiles-cache\\file207447f36801.Rprof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
<p>We see that the first prime factors function runs faster and spends the majority of the time in the while loop and in the recursive part of the function which we would expect. In the second implementation the majority of time is spent in the while loop and checking if <code>i</code> divides <code>r</code>. These steps are both done together in the first implementation. It is clear that the first implementation is more efficient.</p>
</div>
</div>
<div id="performance" class="section level2">
<h2>Performance</h2>
<p>R code is often not optimal in terms of performance, writing in C would run faster. For many core operations R delegates the task to routines written in C.</p>
<div id="memory-management" class="section level3">
<h3>Memory management</h3>
<p>A main feature of R is its pass-by-value semantics. This makes the language easy to use but more difficult to write code that performs well. There are hidden optimizations in R that improve performance. When you update elements of an array in a for loop, multiple copies of the array are not made. This would make time complexity <span class="math inline">\(O(n^2)\)</span>. Though small changes that would not affect pass-by-reference can cause multiple copies of an array to be made. This can happen when updating a vector with a function.</p>
</div>
<div id="column-major-storage" class="section level3">
<h3>Column-major storage</h3>
<p>When a matrix is stored in memory it is typically mapped to a contiguous block of memory. This is done by coloum-major or row-major storage. R uses column-major order, which means that elements in each column are stored in contiguous blocks. This has an implication on performance. For example a matrix filled by row will take longer than a matrix stored by column. This is because reading and writing memory in contiguous blocks is faster than reading memory in separate locations.</p>
</div>
<div id="code-in-another-languague" class="section level3">
<h3>Code in another languague</h3>
<p>It is possible to call code that is written in another language (for example C) from <code>R</code> using the <code>Rcpp</code> function. This is an important way to improve performance.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
